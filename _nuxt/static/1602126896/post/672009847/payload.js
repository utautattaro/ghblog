__NUXT_JSONP__("/post/672009847", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P){return {data:[{title:"会員データの管理画面での存在確認について質問です",body:"SwiftでNCMBを利用しております。\r\n\r\nアプリからNCMBへログイン処理(会員登録)を行うと、\r\n「会員管理」クラスに会員データレコードが一つ追加されると思います。\r\n最終ログイン期間などを条件に会員データを削除する場合を想定し、\r\n管理画面でユーザーのレコードを削除した場合、\r\nユーザーのデータがない場合は再度アプリ側でログイン処理を表示させたいのですが、\r\nその判定方法が分からない状況です。\r\n\r\n`NCMBUser.currentUser`でデータが取得出来なければ判定に使用できるのではないかと考えたのですが、\r\nどうやらこちらはアプリのキャッシュを取得しているらしく、管理画面側でデータを削除した場合でも\r\nアプリ側では値が入ってしまいます。\r\n\r\n方法をご存知の方はご教示頂けましたら幸いでございます。\r\n",created_at:"2020-08-03T11:31:56Z",user:{login:s,id:v,node_id:q,avatar_url:r,gravatar_id:a,url:I,html_url:J,followers_url:h,following_url:i,gists_url:j,starred_url:k,subscriptions_url:l,organizations_url:m,repos_url:n,events_url:o,received_events_url:p,type:b,site_admin:c},comments:[{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F667988780",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161#issuecomment-667988780",issue_url:d,id:667988780,node_id:"MDEyOklzc3VlQ29tbWVudDY2Nzk4ODc4MA==",user:{login:t,id:u,node_id:g,avatar_url:w,gravatar_id:a,url:x,html_url:y,followers_url:z,following_url:A,gists_url:B,starred_url:C,subscriptions_url:D,organizations_url:E,repos_url:F,events_url:G,received_events_url:H,type:b,site_admin:c},created_at:K,updated_at:K,author_association:f,body:"アプリの起動時にfetchを実行してみるのはいかがでしょうか。アプリ内ではキャッシュを使って復元しているので、セッションが切れている可能性もあります。そうした場合を踏まえて、アプリ起動時にはセッションの妥当性チェックが必要です。\r\n\r\nfetchがエラーを起こした場合、セッションが切れているか会員が存在しないかのどちらかが考えられます。どちらの場合でも一旦ログアウト処理（キャッシュ削除）してログイン画面に戻せば、会員が存在しない場合はログインエラーになるでしょう。\r\n",performed_via_github_app:e},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F667994238",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161#issuecomment-667994238",issue_url:d,id:667994238,node_id:"MDEyOklzc3VlQ29tbWVudDY2Nzk5NDIzOA==",user:{login:s,id:v,node_id:q,avatar_url:r,gravatar_id:a,url:I,html_url:J,followers_url:h,following_url:i,gists_url:j,starred_url:k,subscriptions_url:l,organizations_url:m,repos_url:n,events_url:o,received_events_url:p,type:b,site_admin:c},created_at:"2020-08-03T12:25:35Z",updated_at:"2020-08-03T12:27:27Z",author_association:f,body:"goofmint様\r\n\r\nfetchはswiftSDKで使用できるものでしょうか？\r\n調べるとjavascriptでの使用法しか出てこず...\r\n\r\nfetchInBackground()のことでしょうか？",performed_via_github_app:e},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F668019566",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161#issuecomment-668019566",issue_url:d,id:668019566,node_id:"MDEyOklzc3VlQ29tbWVudDY2ODAxOTU2Ng==",user:{login:t,id:u,node_id:g,avatar_url:w,gravatar_id:a,url:x,html_url:y,followers_url:z,following_url:A,gists_url:B,starred_url:C,subscriptions_url:D,organizations_url:E,repos_url:F,events_url:G,received_events_url:H,type:b,site_admin:c},created_at:L,updated_at:L,author_association:f,body:"https:\u002F\u002Fmbaas.nifcloud.com\u002Fdoc\u002Fcurrent\u002Fdatastore\u002Fbasic_usage_swift.html#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E5%8F%96%E5%BE%97\r\n\r\nこちらですね。ユーザオブジェクトはNCMBObjectを継承しているので、同じように利用できるはずです。\r\n",performed_via_github_app:e},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F668483422",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161#issuecomment-668483422",issue_url:d,id:668483422,node_id:"MDEyOklzc3VlQ29tbWVudDY2ODQ4MzQyMg==",user:{login:s,id:v,node_id:q,avatar_url:r,gravatar_id:a,url:I,html_url:J,followers_url:h,following_url:i,gists_url:j,starred_url:k,subscriptions_url:l,organizations_url:m,repos_url:n,events_url:o,received_events_url:p,type:b,site_admin:c},created_at:"2020-08-04T09:15:22Z",updated_at:"2020-08-04T09:16:44Z",author_association:f,body:"goofmint様\r\n\r\nコメントありがとうございます。\r\n今このような状況に陥っております。\r\n\r\n1.アプリを起動しNCMBログイン成功→ダッシュボード上の会員管理にデータが追加される。\r\n2.管理画面から1の会員レコードを削除\r\n3.アプリ側でgoofmint様のご指摘にありましたfetch()を使用→取得に失敗する(期待通りの動作)\r\n4.ログアウト処理を実行する→「ログアウトに失敗しました」と表示される。\r\n5.ログアウトに成功したら再度ログインの流れにもっていき、ダッシュボード上に会員レコードが登録されてほしい。\r\n\r\n今、3までは期待通りの動作なのですが、\r\n4のログアウト処理が失敗しており、これが解決出来ておりません。\r\nログアウトがうまくいけば、キャッシュやセッション情報などがクリアされ、\r\nログイン処理を行えば管理画面にデータが再登録されるのではないかと予想しているのですが、\r\nログアウトが失敗するのはなぜかと苦戦しております。\r\n\r\nちなみに、ログアウト失敗時のエラーコードは下記となっております。\r\n`NCMBApiError(code: \"E401001\", error: \"Authentication error by header incorrect.\")`\r\n\r\nこちらはもしなにかご存知であればご教示頂けますと幸いでございます。",performed_via_github_app:e},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F668489413",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161#issuecomment-668489413",issue_url:d,id:668489413,node_id:"MDEyOklzc3VlQ29tbWVudDY2ODQ4OTQxMw==",user:{login:t,id:u,node_id:g,avatar_url:w,gravatar_id:a,url:x,html_url:y,followers_url:z,following_url:A,gists_url:B,starred_url:C,subscriptions_url:D,organizations_url:E,repos_url:F,events_url:G,received_events_url:H,type:b,site_admin:c},created_at:M,updated_at:M,author_association:f,body:"ログアウト処理が失敗するのは、セッションが不正であるためです（会員がいなくなっているため）。そのため処理としては、ローカルの情報さえ削除すればいいはずです。以下の処理は可能でしょうか？\r\n\r\n```swift\r\nNCMBUser.deleteFile()\r\nNCMBUser._currentUser = nil\r\n```\r\n\r\nhttps:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002Fncmb_swift\u002Fblob\u002F15c707fc8b899c4ca09675440ce5268e4b3660fe\u002FNCMB\u002FNCMBUser.swift#L518\r\n\r\n会員が存在しない場合、クラウド側にログアウト処理を送信する意味はないので、いきなりdeleteFileと_currentUserにnilを適用すればログアウト状態になるかと思います。\r\n\r\n",performed_via_github_app:e},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F668503863",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161#issuecomment-668503863",issue_url:d,id:668503863,node_id:"MDEyOklzc3VlQ29tbWVudDY2ODUwMzg2Mw==",user:{login:s,id:v,node_id:q,avatar_url:r,gravatar_id:a,url:I,html_url:J,followers_url:h,following_url:i,gists_url:j,starred_url:k,subscriptions_url:l,organizations_url:m,repos_url:n,events_url:o,received_events_url:p,type:b,site_admin:c},created_at:"2020-08-04T09:59:06Z",updated_at:"2020-08-05T07:15:21Z",author_association:f,body:"なるほど、ログアウト処理は必要ないのですね！\r\n\r\n`NCMBUser.deleteFile()`\r\nこちらですが、NCMBUserにはdeleteFileメソッドはありませんでした。\r\nhttps:\u002F\u002Fmbaas.nifcloud.com\u002Fassets\u002Fsdk_doc\u002Fswift\u002FClasses\u002FNCMBUser.html#\u002Fs:4NCMB8NCMBUserC6deleteAA10NCMBResultOyytGyF\r\n\r\nまたこちらSwiftでは\"get-only\"でしてnilを設定不可能になっております。\r\n`NCMBUser.currentUser = nil`\r\n\r\ngoofmint様はjavascriptでの実装法でしょうか？",performed_via_github_app:e},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F669674137",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161#issuecomment-669674137",issue_url:d,id:669674137,node_id:"MDEyOklzc3VlQ29tbWVudDY2OTY3NDEzNw==",user:{login:t,id:u,node_id:g,avatar_url:w,gravatar_id:a,url:x,html_url:y,followers_url:z,following_url:A,gists_url:B,starred_url:C,subscriptions_url:D,organizations_url:E,repos_url:F,events_url:G,received_events_url:H,type:b,site_admin:c},created_at:"2020-08-06T04:19:04Z",updated_at:"2020-08-06T04:19:27Z",author_association:f,body:"うーん、現状だとうまい解決法がなさそうです。\r\n\r\nNCMBUser.swiftを直接編集してしまう方法くらいですね。\r\n\r\n```swift\r\n    \u002F\u002F\u002F ログアウトを非同期処理にて行います。\r\n    \u002F\u002F\u002F\r\n    \u002F\u002F\u002F - Parameter callback: レスポンス取得後に実行されるコールバックです。\r\n    public class func logOutInBackground(callback: @escaping NCMBHandler\u003CVoid\u003E) -\u003E Void {\r\n        NCMBLogoutService().logOut(callback: {(result: NCMBResult\u003CNCMBResponse\u003E) -\u003E Void in\r\n            \u002F\u002F ※ 変更点\r\n            \u002F\u002F 処理を上に持ってくる（ログアウト処理の結果に関わらず、ローカルデータを消す）\r\n            deleteFile()\r\n            _currentUser = nil\r\n            switch result {\r\n                case .success(_):\r\n                    callback(NCMBResult\u003CVoid\u003E.success(()))\r\n                    break\r\n                case let .failure(error):\r\n                    callback(NCMBResult\u003CVoid\u003E.failure(error))\r\n                    break\r\n            }\r\n        })\r\n    }\r\n```",performed_via_github_app:e},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F669824497",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161#issuecomment-669824497",issue_url:d,id:669824497,node_id:"MDEyOklzc3VlQ29tbWVudDY2OTgyNDQ5Nw==",user:{login:s,id:v,node_id:q,avatar_url:r,gravatar_id:a,url:I,html_url:J,followers_url:h,following_url:i,gists_url:j,starred_url:k,subscriptions_url:l,organizations_url:m,repos_url:n,events_url:o,received_events_url:p,type:b,site_admin:c},created_at:"2020-08-06T09:39:04Z",updated_at:"2020-08-06T09:39:47Z",author_association:f,body:"方法がないのですね。。\r\nありがとうございます。\r\n\r\nユーザー数が膨大になる場合、最終ログインが数年前などのユーザーはバックアップ用の別のテーブルに移行させ、\r\n会員管理テーブルから削除したほうがDBの圧迫を回避出来ると思い、\r\n管理画面からの削除も出来たほうが良いと考えてのこちらの質問だったのですが、\r\nみなさんはどのように対応されているのでしょうか。気になります。",performed_via_github_app:e},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F669832098",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161#issuecomment-669832098",issue_url:d,id:669832098,node_id:"MDEyOklzc3VlQ29tbWVudDY2OTgzMjA5OA==",user:{login:t,id:u,node_id:g,avatar_url:w,gravatar_id:a,url:x,html_url:y,followers_url:z,following_url:A,gists_url:B,starred_url:C,subscriptions_url:D,organizations_url:E,repos_url:F,events_url:G,received_events_url:H,type:b,site_admin:c},created_at:N,updated_at:N,author_association:f,body:"ユーザ数が相当にならない限りはあまり気に必要はないかなと思います。一般的なデータストアのもので、数億行とかになった場合は注意が必要だと思いますが。\r\n",performed_via_github_app:e},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F669835593",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161#issuecomment-669835593",issue_url:d,id:669835593,node_id:"MDEyOklzc3VlQ29tbWVudDY2OTgzNTU5Mw==",user:{login:s,id:v,node_id:q,avatar_url:r,gravatar_id:a,url:I,html_url:J,followers_url:h,following_url:i,gists_url:j,starred_url:k,subscriptions_url:l,organizations_url:m,repos_url:n,events_url:o,received_events_url:p,type:b,site_admin:c},created_at:O,updated_at:O,author_association:f,body:"現在Basicプランを使用しており、どの程度の会員数まで保存できるのか不安でこちらの質問に至りました。\r\nBasicプランはAPIの上限等はございますが、DBの保存容量の制限もございますのでしょうか？",performed_via_github_app:e},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F671799013",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161#issuecomment-671799013",issue_url:d,id:671799013,node_id:"MDEyOklzc3VlQ29tbWVudDY3MTc5OTAxMw==",user:{login:t,id:u,node_id:g,avatar_url:w,gravatar_id:a,url:x,html_url:y,followers_url:z,following_url:A,gists_url:B,starred_url:C,subscriptions_url:D,organizations_url:E,repos_url:F,events_url:G,received_events_url:H,type:b,site_admin:c},created_at:P,updated_at:P,author_association:f,body:"https:\u002F\u002Fmbaas.nifcloud.com\u002Fprice.htm\r\n\r\nここにありますが、無料の場合は5GBまでです。",performed_via_github_app:e}]}],fetch:[],mutations:void 0}}("","User",false,"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1161",null,"NONE","MDQ6VXNlcjU3MDk=","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fhirai-kazumasa\u002Ffollowers","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fhirai-kazumasa\u002Ffollowing{\u002Fother_user}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fhirai-kazumasa\u002Fgists{\u002Fgist_id}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fhirai-kazumasa\u002Fstarred{\u002Fowner}{\u002Frepo}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fhirai-kazumasa\u002Fsubscriptions","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fhirai-kazumasa\u002Forgs","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fhirai-kazumasa\u002Frepos","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fhirai-kazumasa\u002Fevents{\u002Fprivacy}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fhirai-kazumasa\u002Freceived_events","MDQ6VXNlcjY4MzY5MDEz","https:\u002F\u002Favatars2.githubusercontent.com\u002Fu\u002F68369013?v=4","hirai-kazumasa","goofmint",5709,68369013,"https:\u002F\u002Favatars2.githubusercontent.com\u002Fu\u002F5709?v=4","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint","https:\u002F\u002Fgithub.com\u002Fgoofmint","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Ffollowers","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Ffollowing{\u002Fother_user}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Fgists{\u002Fgist_id}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Fstarred{\u002Fowner}{\u002Frepo}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Fsubscriptions","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Forgs","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Frepos","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Fevents{\u002Fprivacy}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Freceived_events","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fhirai-kazumasa","https:\u002F\u002Fgithub.com\u002Fhirai-kazumasa","2020-08-03T12:12:34Z","2020-08-03T13:21:51Z","2020-08-04T09:27:59Z","2020-08-06T09:52:44Z","2020-08-06T10:00:40Z","2020-08-11T08:12:16Z")));