__NUXT_JSONP__("/post/681990950", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O){return {data:[{title:"GoogleAppsScriptを用いたスクリプトの実行について",body:"スクリプトにて(UpdateSoaring.js)\r\n\r\n```js\r\nvar ncmb = new NCMB(apikey, clientkey);\r\nvar MusicData = ncmb.DataStore(\"MusicData\");\r\nvar Data = new MusicData();\r\nData.set(\"SoaringCount\", 0).save()\r\n    .then(function (Data) {\r\n        Data.set(\"SoaringCount\", 0);\r\n        return Data.update();\r\n    })\r\n```\r\n\r\nGoogleAppsScriptにて\r\n\r\n```js\r\n var ncmb = new NCMB(application_key, client_key);\r\n  ncmb.Script.exec(\"PUT\", \"UpdateSoaring.js\").then(function(res){\r\n        \u002F\u002F 実行後処理\r\n  })\r\n  .catch(function(err){\r\n        \u002F\u002F エラー処理\r\n  });\r\n```\r\n\r\nを実行したところエラーが出てしまいます。\r\nMusicDataというクラス内のすべてのレコードのSoraeingCountというフィールドの値を0にしたいのですが、どう書けばよいでしょうか？",created_at:"2020-08-19T16:49:01Z",user:{login:q,id:s,node_id:k,avatar_url:p,gravatar_id:a,url:r,html_url:t,followers_url:g,following_url:h,gists_url:i,starred_url:j,subscriptions_url:u,organizations_url:l,repos_url:m,events_url:n,received_events_url:o,type:b,site_admin:c},comments:[{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F676849193",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1170#issuecomment-676849193",issue_url:e,id:676849193,node_id:"MDEyOklzc3VlQ29tbWVudDY3Njg0OTE5Mw==",user:{login:I,id:J,node_id:v,avatar_url:w,gravatar_id:a,url:x,html_url:y,followers_url:z,following_url:A,gists_url:B,starred_url:C,subscriptions_url:D,organizations_url:E,repos_url:F,events_url:G,received_events_url:H,type:b,site_admin:c},created_at:"2020-08-20T01:52:06Z",updated_at:"2020-08-20T01:55:13Z",author_association:f,body:"\u003Cs\u003Eフィードバックありがとうございます。問題はスクリプトのPUTに対応していないことです…。ちょっと見てみます。すぐ対応できそうであれば、実装します。\u003C\u002Fs\u003E\r\n\r\n違いますね。 `UpdateSoaring.js` 側の問題そうです。\r\n\r\n",performed_via_github_app:d},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F676851516",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1170#issuecomment-676851516",issue_url:e,id:676851516,node_id:"MDEyOklzc3VlQ29tbWVudDY3Njg1MTUxNg==",user:{login:I,id:J,node_id:v,avatar_url:w,gravatar_id:a,url:x,html_url:y,followers_url:z,following_url:A,gists_url:B,starred_url:C,subscriptions_url:D,organizations_url:E,repos_url:F,events_url:G,received_events_url:H,type:b,site_admin:c},created_at:K,updated_at:K,author_association:f,body:"全レコードの更新メソッドはないので、次のようになります。適当なコードなので、エラーが出たら適宜修正してください。\r\n\r\n```js\r\nvar ncmb = new NCMB(apikey, clientkey);\r\nvar MusicData = ncmb.DataStore(\"MusicData\");\r\n\r\n(async () =\u003E {\r\n  await updateAll(MusicData);\r\n})();\r\n\r\nasync function updateAll(obj) {\r\n  const ary = await obj\r\n    .notEqualTo('SoaringCount', 0) \u002F\u002F 0じゃないもの\r\n    .limit(1000).fetchAll(); \u002F\u002F 最大の1000件を取得\r\n  \u002F\u002F 結果がなければ終了\r\n  if (ary.length === 0) {\r\n    return true;\r\n  }\r\n  const promises = [];\r\n  for (let obj of ary) {\r\n    promises.push(obj.set(\"SoaringCount\", 0).update());\r\n  }\r\n  await Promise.all(promises);\r\n  \u002F\u002F さらにデータがあるかも知れないので実行\r\n  await updateAll();\r\n}\r\n```",performed_via_github_app:d},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F677770779",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1170#issuecomment-677770779",issue_url:e,id:677770779,node_id:"MDEyOklzc3VlQ29tbWVudDY3Nzc3MDc3OQ==",user:{login:q,id:s,node_id:k,avatar_url:p,gravatar_id:a,url:r,html_url:t,followers_url:g,following_url:h,gists_url:i,starred_url:j,subscriptions_url:u,organizations_url:l,repos_url:m,events_url:n,received_events_url:o,type:b,site_admin:c},created_at:L,updated_at:L,author_association:f,body:"ありがとうございます。\r\n先ほどのコードを実行したところ\r\n`{\r\n  \"Status\": \"ERROR\",\r\n  \"RequestHeaders\": \"{\\\"host\\\":\\\"script-console.mbaas.api.nifcloud.com\\\",\\\"connection\\\":\\\"close\\\",\\\"content-length\\\":\\\"139\\\",\\\"accept\\\":\\\"application\u002Fjson, text\u002Fplain, *\u002F*\\\",\\\"user-agent\\\":\\\"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F83.0.4103.98 Safari\u002F537.36\\\",\\\"content-type\\\":\\\"multipart\u002Fform-data; boundary=----WebKitFormBoundaryLMLzC9vj6cLDgPcD\\\",\\\"origin\\\":\\\"https:\u002F\u002Fconsole.mbaas.nifcloud.com\\\",\\\"sec-fetch-site\\\":\\\"same-site\\\",\\\"sec-fetch-mode\\\":\\\"cors\\\",\\\"sec-fetch-dest\\\":\\\"empty\\\",\\\"referer\\\":\\\"https:\u002F\u002Fconsole.mbaas.nifcloud.com\u002F\\\",\\\"accept-encoding\\\":\\\"gzip, deflate, br\\\",\\\"accept-language\\\":\\\"ja-JP,ja;q=0.9,en-US;q=0.8,en;q=0.7\\\"}\",\r\n  \"RequestQuery\": \"{}\",\r\n  \"ResponseHeaders\": \"{}\",\r\n  \"Error\": \"ScriptError: ReferenceError: NCMB is not defined\\n    at Object.\u003Canonymous\u003E (\u002Ftmp\u002FUpdateSoaring.js:1:12)\\n    at Module._compile (internal\u002Fmodules\u002Fcjs\u002Floader.js:1158:30)\\n    at Object.Module._extensions..js (internal\u002Fmodules\u002Fcjs\u002Floader.js:1178:10)\\n    at Module.load (internal\u002Fmodules\u002Fcjs\u002Floader.js:1002:32)\\n    at Function.Module._load (internal\u002Fmodules\u002Fcjs\u002Floader.js:901:14)\\n    at Module.require (internal\u002Fmodules\u002Fcjs\u002Floader.js:1044:19)\\n    at require (internal\u002Fmodules\u002Fcjs\u002Fhelpers.js:77:18)\\n    at Module._compile (internal\u002Fmodules\u002Fcjs\u002Floader.js:1158:30)\",\r\n  \"Duration\": 365,\r\n  \"created_at\": \"2020-08-19T16:00:54.000Z\",\r\n  \"updated_at\": \"2020-08-19T16:00:55.000Z\",\r\n  \"ResponseStatus\": 500,\r\n  \"ScriptIdentifier\": \"UpdateSoaring.js\"\r\n}`\r\nこのようなエラーが発生したのですが何が原因なのでしょうか？",performed_via_github_app:d},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F677997840",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1170#issuecomment-677997840",issue_url:e,id:677997840,node_id:"MDEyOklzc3VlQ29tbWVudDY3Nzk5Nzg0MA==",user:{login:I,id:J,node_id:v,avatar_url:w,gravatar_id:a,url:x,html_url:y,followers_url:z,following_url:A,gists_url:B,starred_url:C,subscriptions_url:D,organizations_url:E,repos_url:F,events_url:G,received_events_url:H,type:b,site_admin:c},created_at:M,updated_at:M,author_association:f,body:"スクリプトのサンプルコードはこちらにあるので参照してください。\r\n\r\nhttps:\u002F\u002Fmbaas.nifcloud.com\u002Fdoc\u002Fcurrent\u002Fscript\u002Freference_nodejs.html#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89\r\n\r\nローカルでテストする方法も書いてありますので、そちらが参考になるかと思います。\r\n\r\n※ ちなみにエラーメッセージは `Error` のところに書いてありますが、NCMBがないというエラー（requireしていない）というものになります。\r\n",performed_via_github_app:d},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F680959539",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1170#issuecomment-680959539",issue_url:e,id:680959539,node_id:"MDEyOklzc3VlQ29tbWVudDY4MDk1OTUzOQ==",user:{login:q,id:s,node_id:k,avatar_url:p,gravatar_id:a,url:r,html_url:t,followers_url:g,following_url:h,gists_url:i,starred_url:j,subscriptions_url:u,organizations_url:l,repos_url:m,events_url:n,received_events_url:o,type:b,site_admin:c},created_at:N,updated_at:N,author_association:f,body:"ありがとうございます！\r\nGoogleAppsからエラーの報告は出るものの値は0に更新できています。",performed_via_github_app:d},{url:"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002Fcomments\u002F683435579",html_url:"https:\u002F\u002Fgithub.com\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1170#issuecomment-683435579",issue_url:e,id:683435579,node_id:"MDEyOklzc3VlQ29tbWVudDY4MzQzNTU3OQ==",user:{login:q,id:s,node_id:k,avatar_url:p,gravatar_id:a,url:r,html_url:t,followers_url:g,following_url:h,gists_url:i,starred_url:j,subscriptions_url:u,organizations_url:l,repos_url:m,events_url:n,received_events_url:o,type:b,site_admin:c},created_at:O,updated_at:O,author_association:f,body:"やっぱりできていませんでした。NCMBのダッシュボードのスクリプトから実行すると値が0に更新されているのでおそらくGoogleAppScript側のコードに問題があると思うのですが、下記のコードを実行しているのですが、どこが問題でしょうか？\r\n`function DataSet(){\r\n  var application_key = \"ea25a419458420ee0d676cf8a65f2bc887283023a901271b0e02742736d5fb55\";\r\n  var client_key = \"3a9acdb12b32dc76cc120c2cc0eb001e18130a6296c9775d80c23f4317bccf50\";\r\n  var ncmb = new NCMB(application_key, client_key);\r\n  ncmb.Script.exec(\"PUT\", \"UpdateSoaring.js\").then(function(res){\r\n        \u002F\u002F 実行後処理\r\n  })\r\n  .catch(function(err){\r\n        \u002F\u002F エラー処理\r\n  });\r\n}`\r\n\r\n↓エラー\r\n![2020-08-31 00 37 48 script google com e15d7612f265](https:\u002F\u002Fuser-images.githubusercontent.com\u002F58741134\u002F91663232-a2be0900-eb22-11ea-9774-597a764ce0c1.png)\r\n\r\n",performed_via_github_app:d}]}],fetch:[],mutations:void 0}}("","User",false,null,"https:\u002F\u002Fapi.github.com\u002Frepos\u002FNIFCLOUD-mbaas\u002FUserCommunity\u002Fissues\u002F1170","NONE","https:\u002F\u002Fapi.github.com\u002Fusers\u002FCafelatte8610\u002Ffollowers","https:\u002F\u002Fapi.github.com\u002Fusers\u002FCafelatte8610\u002Ffollowing{\u002Fother_user}","https:\u002F\u002Fapi.github.com\u002Fusers\u002FCafelatte8610\u002Fgists{\u002Fgist_id}","https:\u002F\u002Fapi.github.com\u002Fusers\u002FCafelatte8610\u002Fstarred{\u002Fowner}{\u002Frepo}","MDQ6VXNlcjU4NzQxMTM0","https:\u002F\u002Fapi.github.com\u002Fusers\u002FCafelatte8610\u002Forgs","https:\u002F\u002Fapi.github.com\u002Fusers\u002FCafelatte8610\u002Frepos","https:\u002F\u002Fapi.github.com\u002Fusers\u002FCafelatte8610\u002Fevents{\u002Fprivacy}","https:\u002F\u002Fapi.github.com\u002Fusers\u002FCafelatte8610\u002Freceived_events","https:\u002F\u002Favatars0.githubusercontent.com\u002Fu\u002F58741134?v=4","Cafelatte8610","https:\u002F\u002Fapi.github.com\u002Fusers\u002FCafelatte8610",58741134,"https:\u002F\u002Fgithub.com\u002FCafelatte8610","https:\u002F\u002Fapi.github.com\u002Fusers\u002FCafelatte8610\u002Fsubscriptions","MDQ6VXNlcjU3MDk=","https:\u002F\u002Favatars2.githubusercontent.com\u002Fu\u002F5709?v=4","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint","https:\u002F\u002Fgithub.com\u002Fgoofmint","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Ffollowers","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Ffollowing{\u002Fother_user}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Fgists{\u002Fgist_id}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Fstarred{\u002Fowner}{\u002Frepo}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Fsubscriptions","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Forgs","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Frepos","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Fevents{\u002Fprivacy}","https:\u002F\u002Fapi.github.com\u002Fusers\u002Fgoofmint\u002Freceived_events","goofmint",5709,"2020-08-20T02:01:24Z","2020-08-20T16:32:43Z","2020-08-21T02:09:23Z","2020-08-26T15:41:09Z","2020-08-30T15:41:23Z")));